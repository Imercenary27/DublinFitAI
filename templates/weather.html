<!-- templates/weather.html -->
{% extends "base.html" %}

{% block title %}Current Weather - Dublin Fitness Companion{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Current Weather Conditions</h5>
                <div id="weather-info" class="text-center">
                    <button onclick="getLocation()" class="btn btn-primary mb-3">
                        Get Current Location Weather
                    </button>
                    <div id="weather-data"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showWeather, showError);
    } else {
        document.getElementById('weather-data').innerHTML = 
            "Geolocation is not supported by this browser.";
    }
}

function showWeather(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const apiKey = 'yourApiKeyhere'; // Replace with your OpenWeatherMap API key
    
    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`)
        .then(response => response.json())
        .then(data => {
            const weatherHtml = `
                <h4>${data.name}</h4>
                <div class="display-4">${Math.round(data.main.temp)}°C</div>
                <img src="<https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png">
                <p>${data.weather[0].description}</p>
                <div class="row">
                    <div class="col">
                        <div>Feels like: ${Math.round(data.main.feels_like)}°C</div>
                        <div>Humidity: ${data.main.humidity}%</div>
                    </div>
                    <div class="col">
                        <div>Wind: ${data.wind.speed} m/s</div>
                        <div>Pressure: ${data.main.pressure} hPa</div>
                    </div>
                </div>
            `;
            document.getElementById('weather-data').innerHTML = weatherHtml;
        })
        .catch(error => {
            console.error('Error fetching weather:', error);
            document.getElementById('weather-data').innerHTML = 
                "Error retrieving weather data. Please try again.";
        });
}

function showError(error) {
    const errorMessages = {
        PERMISSION_DENIED: "User denied the request for Geolocation.",
        POSITION_UNAVAILABLE: "Location information is unavailable.",
        TIMEOUT: "The request to get user location timed out.",
        UNKNOWN_ERROR: "An unknown error occurred."
    };
    
    document.getElementById('weather-data').innerHTML = 
        `<div class="alert alert-danger">${errorMessages[error.code] || error.message}</div>`;
}
</script>
{% endblock %}
